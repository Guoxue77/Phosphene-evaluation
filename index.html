<!DOCTYPE html>
<html>
<head>
    <title>Phosphene Evaluation Program</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            font-size: 24px;
            color: blue;
        }

        select {
            font-size: 20px;
        }

        .intensity-options {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <h1>Phosphene Evaluation Program</h1>
    <p><span style="font-size: 24px; font-weight: bold; color: blue;">Please rate the intensity of the perceived phosphenes on a scale of 0 to 4; 0 means no perception, 4 means strong perception.</span></p>
    <div class="intensity-options">
        <label>0</label>
        <label>1</label>
        <label>2</label>
        <label>3</label>
        <label>4</label>
    </div>
    <div id="stimulationDiv">
        <!-- Stimuli presentation area -->
    </div>
    <div id="results">
        <!-- Results display area -->
    </div>
    <script>
        const numStimulations = 10; // Number of stimulations
        let currentStimulation = 0; // Current stimulation count
        const responses = []; // Array to store responses

        const stimulationDiv = document.getElementById('stimulationDiv');
        const resultsDiv = document.getElementById('results');

        // Prompt for Participant ID and Session details
        const participantID = prompt('Enter Participant ID:');
        const session = prompt('Enter Session details:');

        function presentStimulation() {
            if (currentStimulation < numStimulations) {
                stimulationDiv.innerHTML = `Stimulation Trial: ${currentStimulation + 1}`;
            } else {
                displayResults();
            }
        }

        function displayResults() {
            resultsDiv.innerHTML = 'Results:<br>';
            for (let i = 0; i < responses.length; i++) {
                resultsDiv.innerHTML += `Stimulation Trial ${i + 1}: Intensity ${responses[i]}<br>`;
            }
        }

        function collectResponse(intensity) {
            responses.push(intensity);
            currentStimulation++;
            if (currentStimulation < numStimulations) {
                presentStimulation();
            } else {
                exportToExcel();
            }
        }

        function exportToExcel() {
            // Create a data array for Excel export
            const data = [['Participant ID', 'Session', 'Stimulation Trial', 'Stimulation Intensity']];

            for (let i = 0; i < responses.length; i++) {
                data.push([participantID, session, i + 1, responses[i]]);
            }

            // Generate the Excel file name based on Participant ID and Session
            const fileName = `Phosphene_Evaluation_${participantID}_${session}.xlsx`;

            // Create a new workbook and add the data
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, 'Phosphene_Evaluation');

            // Export the data to an Excel file with the generated name
            XLSX.writeFile(wb, fileName);
        }

        // Start the evaluation
        presentStimulation();
    </script>
</body>
</html>



