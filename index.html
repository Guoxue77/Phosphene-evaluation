<!DOCTYPE html>
<html>
<head>
    <title>Phosphene Evaluation Program</title>
    <!-- Include SheetJS library for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <style>
        /* Style adjustments for better intensity selection visibility */
        select {
            font-size: 20px;
            width: 100px;
        }
    </style>
</head>
<body>
    <h1>Welcome to the Phosphene Evaluation Program</h1>
    <p>Please rate the intensity of the perceived phosphenes on a scale of 0 to 4.</p>
    <div id="stimulationDiv">
        <!-- Stimuli presentation area -->
    </div>
    <div>
        <label for="intensity">Intensity:</label>
        <select id="intensity">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>
        <button id="submit">Submit</button>
    </div>
    <div id="results">
        <!-- Results display area -->
    </div>
    <script>
        const numStimulations = 10; // Number of stimulations
        let currentStimulation = 0; // Current stimulation count
        const responses = []; // Array to store responses

        const stimulationDiv = document.getElementById('stimulationDiv');
        const intensityInput = document.getElementById('intensity');
        const submitButton = document.getElementById('submit');
        const resultsDiv = document.getElementById('results');

        // Prompt for Participant ID and Session details
        const participantID = prompt('Enter Participant ID:');
        const session = prompt('Enter Session details:');

        function presentStimulation() {
            if (currentStimulation < numStimulations) {
                stimulationDiv.innerHTML = `Stimulation Trial: ${currentStimulation + 1}`;
                intensityInput.value = ''; // Reset intensity selection
                intensityInput.disabled = false; // Enable selection
            } else {
                displayResults();
            }
        }

        function displayResults() {
            resultsDiv.innerHTML = 'Results:<br>';
            for (let i = 0; i < responses.length; i++) {
                resultsDiv.innerHTML += `Stimulation Trial ${i + 1}: Intensity ${responses[i]}<br>`;
            }
        }

        submitButton.addEventListener('click', () => {
            const intensity = intensityInput.value;
            if (!isNaN(intensity) && intensity >= 0 && intensity <= 4) {
                responses.push(intensity);
                currentStimulation++;
                if (currentStimulation < numStimulations) {
                    presentStimulation();
                } else {
                    exportToExcel();
                }
            }
        });

        function exportToExcel() {
            // Create a data array for Excel export
            const data = [['Participant ID', 'Session', 'Stimulation Trial', 'Stimulation Intensity']];

            for (let i = 0; i < responses.length; i++) {
                data.push([participantID, session, i + 1, responses[i]]);
            }

            // Generate the Excel file name based on Participant ID and Session
            const fileName = `Phosphene_Evaluation_${participantID}_${session}.xlsx`;

            // Create a new workbook and add the data
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, 'Phosphene_Evaluation');

            // Export the data to an Excel file with the generated name
            XLSX.writeFile(wb, fileName);
        }

        // Start the evaluation
        presentStimulation();
    </script>
</body>
</html>



