<!DOCTYPE html>
<html>
<head>
    <title>Phosphene Evaluation Program</title>
    <!-- Include SheetJS library for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
</head>
<body>
    <h1>Welcome to the Phosphene Evaluation Program</h1>
    <p>Please rate the intensity of the perceived phosphenes on a scale of 0 to 4.</p>
    <div id="stimulationDiv">
        <!-- Stimuli presentation area -->
    </div>
    <div>
        <label for="intensity">Intensity:</label>
        <select id="intensity">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>
        <button id="submit">Submit</button>
    </div>
    <div id="results">
        <!-- Results display area -->
    </div>
    <button id="export">Export to Excel</button>
    <script>
        const numStimulations = 10; // Number of stimulations
        let currentStimulation = 0; // Current stimulation count
        const responses = []; // Array to store responses

        const stimulationDiv = document.getElementById('stimulationDiv');
        const intensityInput = document.getElementById('intensity');
        const submitButton = document.getElementById('submit');
        const resultsDiv = document.getElementById('results');
        const exportButton = document.getElementById('export');

        function presentStimulation() {
            if (currentStimulation < numStimulations) {
                stimulationDiv.innerHTML = `Stimulation ${currentStimulation + 1}`;
            } else {
                displayResults();
            }
        }

        function displayResults() {
            resultsDiv.innerHTML = `Results: ${responses.join(', ')}`;
        }

        submitButton.addEventListener('click', () => {
            const intensity = intensityInput.value;
            if (!isNaN(intensity) && intensity >= 0 && intensity <= 4) {
                responses.push(intensity);
                currentStimulation++;
                presentStimulation();
            }
        });

        exportButton.addEventListener('click', () => {
            // Create a data array for Excel export
            const data = [['Participant ID', 'Session', ...responses]];

            // Prompt for Participant ID and Session details
            const participantID = prompt('Enter Participant ID:');
            const session = prompt('Enter Session details:');

            if (participantID && session) {
                data.push([participantID, session, ...responses]);

                // Create a new workbook and add the data
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(data);
                XLSX.utils.book_append_sheet(wb, ws, 'Phosphene_Evaluation');

                // Export the data to an Excel file
                XLSX.writeFile(wb, 'Phosphene_Evaluation.xlsx');
            }
        });

        // Start the evaluation
        presentStimulation();
    </script>
</body>
</html>

